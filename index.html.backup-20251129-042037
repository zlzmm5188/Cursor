<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Providence åå°ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        .header {
            background: #001529;
            color: white;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .container {
            display: flex;
            height: calc(100vh - 64px);
        }
        .sidebar {
            width: 200px;
            background: #001529;
            color: white;
            padding: 16px 0;
        }
        .menu-item {
            padding: 12px 24px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .menu-item:hover {
            background: #1890ff;
        }
        .menu-item.active {
            background: #1890ff;
        }
        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: #f5f5f5;
        }
        .content h2 {
            font-size: 20px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 24px;
        }
        .card {
            background: white;
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h3 {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 16px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #1890ff;
            margin: 8px 0;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid #e8e8e8;
            color: #333;
        }
        th {
            background: #fafafa;
            font-weight: 600;
            font-size: 14px;
            color: #262626;
            white-space: nowrap;
        }
        td {
            color: #595959;
            font-size: 14px;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: #1890ff;
            color: white;
        }
        .btn-primary:hover {
            background: #40a9ff;
        }
        .btn-danger {
            background: #ff4d4f;
            color: white;
        }
        .btn-danger:hover {
            background: #ff7875;
        }
        .btn:not(.btn-primary):not(.btn-danger) {
            background: #f5f5f5;
            color: #595959;
            border: 1px solid #d9d9d9;
        }
        .btn:not(.btn-primary):not(.btn-danger):hover {
            background: #e6f7ff;
            border-color: #1890ff;
            color: #1890ff;
        }
        .hidden {
            display: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: #ffffff;
            margin: 2% auto;
            padding: 40px;
            border-radius: 12px;
            width: 900px;
            max-height: 92vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            position: relative;
        }
        .modal-content h2 {
            font-size: 22px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 28px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e8e8e8;
        }
        .modal-content h3 {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 16px;
            padding-left: 12px;
            border-left: 3px solid #1890ff;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #262626;
            font-size: 14px;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="password"],
        textarea,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            background: #ffffff;
            color: #262626;
            transition: all 0.3s;
            font-family: inherit;
        }
        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="password"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }
        .form-group input[type="text"]:hover,
        .form-group input[type="number"]:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #40a9ff;
        }
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #bfbfbf;
        }
        .form-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #1890ff;
        }
        .form-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 36px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            line-height: 1.5;
        }
        .form-group small {
            display: block;
            margin-top: 6px;
            color: #8c8c8c;
            font-size: 12px;
            line-height: 1.5;
        }
        .checkbox-group {
            display: flex;
            gap: 24px;
            margin-top: 8px;
            padding: 12px;
            background: #fafafa;
            border-radius: 6px;
            border: 1px solid #e8e8e8;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
            color: #262626;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .checkbox-label:hover {
            background: #e6f7ff;
            color: #1890ff;
        }
        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #1890ff;
        }
        .modal-footer {
            margin-top: 24px;
            text-align: right;
        }
        .settings-panel {
            display: block;
        }
        .settings-panel.hidden {
            display: none;
        }
        .settings-panel h3 {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 16px;
            margin-top: 0;
        }
        .settings-panel h4 {
            font-size: 14px;
            font-weight: 500;
            color: #595959;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>ğŸ“Š Providence åå°ç®¡ç†ç³»ç»Ÿ</h2>
        <div>
            <span id="adminName">ç®¡ç†å‘˜</span>
            <button class="btn btn-danger" onclick="logout()" style="margin-left: 16px;">é€€å‡º</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showPage('dashboard')">ğŸ“Š æ•°æ®æ¦‚è§ˆ</div>
            <div class="menu-item" onclick="showPage('users')">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</div>
            <div class="menu-item" onclick="showPage('projects')">ğŸ“ˆ é¡¹ç›®ç®¡ç†</div>
            <div class="menu-item" onclick="showPage('finance')">ğŸ’° è´¢åŠ¡ç®¡ç†</div>
            <div class="menu-item" onclick="showPage('kyc')">ğŸ†” å®åè®¤è¯å®¡æ ¸</div>
            <div class="menu-item" onclick="showPage('settings')">âš™ï¸ ç³»ç»Ÿè®¾ç½®</div>
            <div class="menu-item" onclick="showPage('logs')">ğŸ“‹ æ“ä½œæ—¥å¿—</div>
        </div>

        <div class="content">
            <!-- æ•°æ®æ¦‚è§ˆ -->
            <div id="dashboard" class="page">
                <h2 style="margin-bottom: 24px;">æ•°æ®æ¦‚è§ˆ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label" style="margin-top: 8px; font-size: 12px;">æ´»è·ƒç”¨æˆ·: <span id="activeUsers">0</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ€»æŠ•èµ„é¢</div>
                        <div class="stat-value" id="totalInvestment">Â¥0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥å……å€¼</div>
                        <div class="stat-value" id="todayRecharge">Â¥0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥æç°</div>
                        <div class="stat-value" id="todayWithdraw">Â¥0</div>
                    </div>
                </div>
                <div class="stats-grid" style="margin-top: 16px;">
                    <div class="stat-card">
                        <div class="stat-label">å¾…å®¡æ ¸å®åè®¤è¯</div>
                        <div class="stat-value" id="pendingKyc">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¾…å®¡æ ¸å……å€¼</div>
                        <div class="stat-value" id="pendingRecharge">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¾…å®¡æ ¸æç°</div>
                        <div class="stat-value" id="pendingWithdraw">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ€»æ”¶ç›Š</div>
                        <div class="stat-value" id="totalRevenue">Â¥0</div>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users" class="page hidden">
                <h2 style="margin-bottom: 24px;">ç”¨æˆ·ç®¡ç†</h2>
                <div class="card" style="margin-bottom: 16px;">
                    <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="userSearch" placeholder="æœç´¢ç”¨æˆ·åã€ID..." style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                        <select id="userStatusFilter" style="padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="active">æ­£å¸¸</option>
                            <option value="frozen">å†»ç»“</option>
                        </select>
                        <select id="userVipFilter" style="padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            <option value="">å…¨éƒ¨VIP</option>
                            <option value="0">VIP0</option>
                            <option value="1">VIP1</option>
                            <option value="2">VIP2</option>
                            <option value="3">VIP3</option>
                            <option value="4">VIP4</option>
                            <option value="5">VIP5</option>
                            <option value="6">VIP6</option>
                            <option value="7">VIP7</option>
                            <option value="8">VIP8</option>
                        </select>
                        <button class="btn btn-primary" onclick="searchUsers()">æœç´¢</button>
                        <button class="btn" onclick="resetUserSearch()">é‡ç½®</button>
                    </div>
                </div>
                <div class="card">
                    <table id="userTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>VIPç­‰çº§</th>
                                <th>å®åè®¤è¯</th>
                                <th>CNYä½™é¢</th>
                                <th>USDTä½™é¢</th>
                                <th>ç´¯è®¡æŠ•èµ„</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr><td colspan="9" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- é¡¹ç›®ç®¡ç† -->
            <div id="projects" class="page hidden">
                <h2 style="margin-bottom: 24px;">é¡¹ç›®ç®¡ç†</h2>
                <div class="card">
                    <button class="btn btn-primary" onclick="createProject()" style="margin-bottom: 16px;">æ–°å»ºé¡¹ç›®</button>
                    <table id="projectTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>é¡¹ç›®åç§°</th>
                                <th>å¹´åŒ–æ”¶ç›Š</th>
                                <th>æœŸé™(å¤©)</th>
                                <th>å¸ç§</th>
                                <th>æ€»é¢åº¦</th>
                                <th>å·²å”®</th>
                                <th>å‰©ä½™</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="projectTableBody">
                            <tr><td colspan="10" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- è´¢åŠ¡ç®¡ç† -->
            <div id="finance" class="page hidden">
                <h2 style="margin-bottom: 24px;">è´¢åŠ¡ç®¡ç†</h2>

                <!-- å……å€¼å®¡æ ¸ -->
                <div class="card">
                    <h3 style="margin-bottom: 16px;">å……å€¼å®¡æ ¸</h3>
                    <div style="margin-bottom: 16px; padding: 12px; background: #f0f2f5; border-radius: 4px; font-size: 13px; color: #666;">
                        <strong>è¯´æ˜ï¼š</strong>é“¶è¡Œå¡è½¬è´¦å……å€¼éœ€è¦äººå·¥å®¡æ ¸ï¼Œéœ€æŸ¥çœ‹è½¬è´¦å‡­è¯åå®¡æ ¸é€šè¿‡æˆ–æ‹’ç»ã€‚USDTã€æ”¯ä»˜å®ç­‰è‡ªåŠ¨åˆ°è´¦æ–¹å¼æ— éœ€å®¡æ ¸ã€‚
                    </div>
                    <table id="rechargeTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·</th>
                                <th>å……å€¼æ–¹å¼</th>
                                <th>é‡‘é¢</th>
                                <th>å¸ç§</th>
                                <th>äº¤æ˜“å•å·</th>
                                <th>æäº¤æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="rechargeTableBody">
                            <tr><td colspan="9" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- æç°å®¡æ ¸ -->
                <div class="card" style="margin-top: 16px;">
                    <h3 style="margin-bottom: 16px;">æç°å®¡æ ¸</h3>
                    <table id="withdrawTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·</th>
                                <th>æç°æ–¹å¼</th>
                                <th>é‡‘é¢</th>
                                <th>å¸ç§</th>
                                <th>æ”¶æ¬¾è´¦æˆ·</th>
                                <th>ç”³è¯·æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawTableBody">
                            <tr><td colspan="9" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- å®åè®¤è¯å®¡æ ¸ -->
            <div id="kyc" class="page hidden">
                <h2 style="margin-bottom: 24px;">å®åè®¤è¯å®¡æ ¸</h2>
                <div class="card">
                    <div style="margin-bottom: 16px;">
                        <button class="btn btn-primary" onclick="loadKycList('pending')" style="margin-right: 8px;">å¾…å®¡æ ¸</button>
                        <button class="btn" onclick="loadKycList('approved')" style="margin-right: 8px;">å·²é€šè¿‡</button>
                        <button class="btn" onclick="loadKycList('rejected')">å·²æ‹’ç»</button>
                    </div>
                    <table id="kycTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>çœŸå®å§“å</th>
                                <th>èº«ä»½è¯å·</th>
                                <th>æäº¤æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="kycTableBody">
                            <tr><td colspan="8" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® - é›†ä¸­å¼é…ç½®é¢æ¿ -->
            <div id="settings" class="page hidden">
                <h2 style="margin-bottom: 24px;">ç³»ç»Ÿè®¾ç½®</h2>
                <div class="card">
                    <div style="margin-bottom: 20px; border-bottom: 1px solid #e8e8e8; padding-bottom: 12px;">
                        <button class="btn btn-primary" onclick="switchSettingsTab('exchange')" id="tabExchange">ğŸ’± æ±‡ç‡è®¾ç½®</button>
                        <button class="btn" onclick="switchSettingsTab('vip')" id="tabVip">ğŸ–ï¸ VIPä¼šå‘˜å‡çº§</button>
                        <button class="btn" onclick="switchSettingsTab('team')" id="tabTeam">ğŸ‘¥ å›¢é˜Ÿç®¡ç†å¥–</button>
                        <button class="btn" onclick="switchSettingsTab('trial')" id="tabTrial">ğŸ æ–°äººä½“éªŒé‡‘</button>
                        <button class="btn" onclick="switchSettingsTab('investment')" id="tabInvestment">ğŸ“Š æŠ•èµ„é…ç½®</button>
                        <button class="btn" onclick="switchSettingsTab('recharge')" id="tabRecharge">ğŸ’³ å……å€¼é…ç½®</button>
                        <button class="btn" onclick="switchSettingsTab('withdraw')" id="tabWithdraw">ğŸ’° æç°é…ç½®</button>
                        <button class="btn" onclick="switchSettingsTab('ribao')" id="tabRibao">ğŸ“ˆ æ—¥åˆ©å®é…ç½®</button>
                    </div>

                    <!-- æ±‡ç‡è®¾ç½® -->
                    <div id="settingsExchange" class="settings-panel">
                        <h3>æ±‡ç‡è®¾ç½®</h3>
                        <div class="form-group">
                            <label>USDT/CNYæ±‡ç‡ *</label>
                            <input type="number" id="exchangeRate" step="0.01" min="0" value="7.2">
                            <small style="color: #8c8c8c;">ç”¨äºè®¡ç®—ç”¨æˆ·èµ„äº§å’ŒæŠ•èµ„é¢åº¦</small>
                        </div>
                    </div>

                    <!-- VIPä¼šå‘˜å‡çº§ -->
                    <div id="settingsVip" class="settings-panel hidden">
                        <h3>VIPä¼šå‘˜å‡çº§é…ç½®</h3>
                        <div id="vipConfigTable" style="overflow-x: auto;"></div>
                        <button class="btn btn-primary" onclick="addVipLevel()" style="margin-top: 12px;">â• æ·»åŠ VIPçº§åˆ«</button>
                    </div>

                    <!-- å›¢é˜Ÿç®¡ç†å¥– -->
                    <div id="settingsTeam" class="settings-panel hidden">
                        <h3>å›¢é˜Ÿç®¡ç†å¥–é…ç½®</h3>
                        <div id="teamRewardTable" style="overflow-x: auto;"></div>
                        <button class="btn btn-primary" onclick="addTeamRewardLevel()" style="margin-top: 12px;">â• æ·»åŠ å¥–åŠ±ç­‰çº§</button>
                    </div>

                    <!-- æ–°äººä½“éªŒé‡‘ -->
                    <div id="settingsTrial" class="settings-panel hidden">
                        <h3>æ–°äººä½“éªŒé‡‘è§„åˆ™</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>ä½“éªŒé‡‘é¢åº¦ (CNY) *</label>
                                <input type="number" id="trialAmountCny" step="0.01" min="0" value="888">
                            </div>
                            <div class="form-group">
                                <label>ä½“éªŒé‡‘é¢åº¦ (USDT) *</label>
                                <input type="number" id="trialAmountUsdt" step="0.01" min="0" value="123">
                            </div>
                            <div class="form-group">
                                <label>æœªæŠ•èµ„è‡ªåŠ¨å›æ”¶æœŸé™ (å¤©) *</label>
                                <input type="number" id="trialDuration" min="1" value="7">
                            </div>
                            <div class="form-group">
                                <label>è¦æ±‚å®åè®¤è¯</label>
                                <select id="trialRequireKyc">
                                    <option value="1">æ˜¯</option>
                                    <option value="0">å¦</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>è¦æ±‚ç»‘å®šæ”¯ä»˜æ–¹å¼</label>
                                <select id="trialRequirePayment">
                                    <option value="1">æ˜¯</option>
                                    <option value="0">å¦</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ¯äººé™é¢†ä¸€æ¬¡</label>
                                <select id="trialOnePerUser">
                                    <option value="1">æ˜¯</option>
                                    <option value="0">å¦</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>è§„åˆ™è¯´æ˜</label>
                            <textarea id="trialDescription" rows="3" style="width: 100%;">å¿…é¡»å®Œæˆå®åè®¤è¯åé¢†å–ï¼Œæ¯äººé™é¢†ä¸€æ¬¡ï¼Œ7å¤©å†…æœªæŠ•èµ„è‡ªåŠ¨å›æ”¶ï¼Œä¸€æ—¦æŠ•èµ„è·Ÿéšé¡¹ç›®å‘¨æœŸï¼Œæ”¶ç›Šå¯æç°ä½†æœ¬é‡‘è‡ªåŠ¨å›æ”¶</textarea>
                        </div>
                    </div>

                    <!-- æŠ•èµ„é…ç½® -->
                    <div id="settingsInvestment" class="settings-panel hidden">
                        <h3>æŠ•èµ„é…ç½®</h3>
                        <h4 style="margin-top: 16px; margin-bottom: 12px;">äººæ°‘å¸ (CNY)</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½æŠ•èµ„é¢</label>
                                <input type="number" id="investMinCny" min="0" value="1000">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜æŠ•èµ„é¢</label>
                                <input type="number" id="investMaxCny" min="0" value="1000000">
                            </div>
                        </div>

                        <h4 style="margin-top: 16px; margin-bottom: 12px;">USDT</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½æŠ•èµ„é¢</label>
                                <input type="number" id="investMinUsdt" min="0" value="100">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜æŠ•èµ„é¢</label>
                                <input type="number" id="investMaxUsdt" min="0" value="100000">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                            <div class="form-group">
                                <label>è¦æ±‚å®åè®¤è¯</label>
                                <select id="investRequireKyc">
                                    <option value="1">æ˜¯</option>
                                    <option value="0">å¦</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>è¦æ±‚ç»‘å®šæ”¯ä»˜æ–¹å¼</label>
                                <select id="investRequirePayment">
                                    <option value="1">æ˜¯</option>
                                    <option value="0">å¦</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- å……å€¼é…ç½® -->
                    <div id="settingsRecharge" class="settings-panel hidden">
                        <h3>å……å€¼é…ç½®</h3>
                        <h4 style="margin-top: 16px; margin-bottom: 12px;">äººæ°‘å¸ (CNY)</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½å……å€¼é¢</label>
                                <input type="number" id="rechargeMinCny" min="0" value="100">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜å……å€¼é¢</label>
                                <input type="number" id="rechargeMaxCny" min="0" value="500000">
                            </div>
                            <div class="form-group">
                                <label>æ‰‹ç»­è´¹ç‡ (%)</label>
                                <input type="number" id="rechargeFeeRateCny" step="0.01" min="0" value="0">
                            </div>
                        </div>

                        <h4 style="margin-top: 16px; margin-bottom: 12px;">USDT</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½å……å€¼é¢</label>
                                <input type="number" id="rechargeMinUsdt" min="0" value="10">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜å……å€¼é¢</label>
                                <input type="number" id="rechargeMaxUsdt" min="0" value="50000">
                            </div>
                            <div class="form-group">
                                <label>æ‰‹ç»­è´¹ç‡ (%)</label>
                                <input type="number" id="rechargeFeeRateUsdt" step="0.01" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- æç°é…ç½® -->
                    <div id="settingsWithdraw" class="settings-panel hidden">
                        <h3>æç°é…ç½®</h3>
                        <h4 style="margin-top: 16px; margin-bottom: 12px;">äººæ°‘å¸ (CNY)</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½æç°é¢</label>
                                <input type="number" id="withdrawMinCny" min="0" value="100">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜æç°é¢</label>
                                <input type="number" id="withdrawMaxCny" min="0" value="500000">
                            </div>
                            <div class="form-group">
                                <label>æ‰‹ç»­è´¹ç‡ (%)</label>
                                <input type="number" id="withdrawFeeRateCny" step="0.01" min="0" value="0.5">
                            </div>
                            <div class="form-group">
                                <label>æ—¥æç°é™é¢</label>
                                <input type="number" id="withdrawDailyLimitCny" min="0" value="50000">
                            </div>
                        </div>

                        <h4 style="margin-top: 16px; margin-bottom: 12px;">USDT</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <div class="form-group">
                                <label>æœ€ä½æç°é¢</label>
                                <input type="number" id="withdrawMinUsdt" min="0" value="10">
                            </div>
                            <div class="form-group">
                                <label>æœ€é«˜æç°é¢</label>
                                <input type="number" id="withdrawMaxUsdt" min="0" value="50000">
                            </div>
                            <div class="form-group">
                                <label>æ‰‹ç»­è´¹ç‡ (%)</label>
                                <input type="number" id="withdrawFeeRateUsdt" step="0.01" min="0" value="0.5">
                            </div>
                            <div class="form-group">
                                <label>æ—¥æç°é™é¢</label>
                                <input type="number" id="withdrawDailyLimitUsdt" min="0" value="5000">
                            </div>
                        </div>
                    </div>

                    <!-- æ—¥åˆ©å®é…ç½® -->
                    <div id="settingsRibao" class="settings-panel hidden">
                        <h3>æ—¥åˆ©å®é…ç½®</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>æ—¥åˆ©ç‡ (CNY) (%)</label>
                                <input type="number" id="ribaoRateCny" step="0.0001" min="0" max="1" value="0.0005">
                                <small style="color: #8c8c8c;">æ¯æ—¥è®¡æ¯</small>
                            </div>
                            <div class="form-group">
                                <label>æ—¥åˆ©ç‡ (USDT) (%)</label>
                                <input type="number" id="ribaoRateUsdt" step="0.0001" min="0" max="1" value="0.0005">
                                <small style="color: #8c8c8c;">æ¯æ—¥è®¡æ¯</small>
                            </div>
                            <div class="form-group">
                                <label>æœ€ä½é‡‘é¢ (CNY)</label>
                                <input type="number" id="ribaoMinCny" min="0" value="100">
                            </div>
                            <div class="form-group">
                                <label>æœ€ä½é‡‘é¢ (USDT)</label>
                                <input type="number" id="ribaoMinUsdt" min="0" value="10">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 16px;">
                            <label>ç»“æ¯æ—¶é—´</label>
                            <input type="text" id="ribaoSettleTime" value="æ¯æ—¥19:00">
                        </div>
                    </div>

                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e8e8e8;">
                        <button class="btn btn-primary" onclick="saveAllSettings()" style="padding: 8px 24px; font-size: 14px;">âœ“ ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæ—¥å¿— -->
            <div id="logs" class="page hidden">
                <h2 style="margin-bottom: 24px;">æ“ä½œæ—¥å¿—</h2>
                <div class="card">
                    <div style="margin-bottom: 16px;">
                        <input type="text" id="logSearch" placeholder="æœç´¢æ—¥å¿—..." style="padding: 8px 12px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
                        <button class="btn btn-primary" onclick="searchLogs()" style="margin-left: 8px;">æœç´¢</button>
                    </div>
                    <table id="logTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ“ä½œç±»å‹</th>
                                <th>æ“ä½œäºº</th>
                                <th>æ“ä½œå†…å®¹</th>
                                <th>æ“ä½œæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <tr><td colspan="5" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºé¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">æ–°å»ºé¡¹ç›®</h2>
            <form id="projectForm">
                <input type="hidden" id="projectId" name="id">

                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div style="margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid #e8e8e8;">
                    <h3>åŸºç¡€ä¿¡æ¯</h3>
                    <div class="form-group">
                        <label>é¡¹ç›®åç§° *</label>
                        <input type="text" id="projectName" name="name" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>å¹´åŒ–æ”¶ç›Šç‡ (%) *</label>
                            <input type="number" id="annualRate" name="annual_rate" step="0.1" min="0" max="50" required>
                        </div>
                        <div class="form-group">
                            <label>æŠ•èµ„æœŸé™ (å¤©) *</label>
                            <input type="number" id="duration" name="duration" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®æè¿°</label>
                        <textarea id="description" name="description" rows="3"></textarea>
                    </div>
                </div>

                <!-- å¸ç§å’Œé¢åº¦è®¾ç½® -->
                <div style="margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid #e8e8e8;">
                    <h3>å¸ç§å’Œé¢åº¦è®¾ç½®</h3>
                    <div class="form-group">
                        <label>æ”¯æŒçš„å¸ç§ *</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="currencyCNY" name="currencies[]" value="CNY" checked>
                                äººæ°‘å¸ (CNY)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="currencyUSDT" name="currencies[]" value="USDT">
                                USDT
                            </label>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>CNYæ€»é¢åº¦</label>
                            <input type="number" id="totalAmountCNY" name="total_amount_cny" step="1000" min="0" placeholder="CNYæ€»é¢åº¦">
                        </div>
                        <div class="form-group">
                            <label>USDTæ€»é¢åº¦</label>
                            <input type="number" id="totalAmountUSDT" name="total_amount_usdt" step="100" min="0" placeholder="USDTæ€»é¢åº¦">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>CNYæœ€ä½æŠ•èµ„é¢</label>
                            <input type="number" id="minInvestmentCNY" name="min_investment_cny" step="100" min="0" placeholder="CNYæœ€ä½æŠ•èµ„">
                        </div>
                        <div class="form-group">
                            <label>USDTæœ€ä½æŠ•èµ„é¢</label>
                            <input type="number" id="minInvestmentUSDT" name="min_investment_usdt" step="10" min="0" placeholder="USDTæœ€ä½æŠ•èµ„">
                        </div>
                    </div>
                </div>

                <!-- è¿”åˆ©è®¾ç½® -->
                <div style="margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid #e8e8e8;">
                    <h3>è¿”åˆ©è®¾ç½®</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>CNYè¿”åˆ©æ¯”ä¾‹ (%)</label>
                            <input type="number" id="rebateCNY" name="rebate_cny" step="0.1" min="0" max="100" value="0" placeholder="CNYè¿”åˆ©æ¯”ä¾‹">
                        </div>
                        <div class="form-group">
                            <label>USDTè¿”åˆ©æ¯”ä¾‹ (%)</label>
                            <input type="number" id="rebateUSDT" name="rebate_usdt" step="0.1" min="0" max="100" value="0" placeholder="USDTè¿”åˆ©æ¯”ä¾‹">
                        </div>
                    </div>
                </div>

                <!-- åŠ æ¯è®¾ç½® -->
                <div style="margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid #e8e8e8;">
                    <h3>åŠ æ¯è®¾ç½®</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>VIPåŠ æ¯ (%)</label>
                            <input type="number" id="vipBonus" name="vip_bonus" step="0.01" min="0" max="10" value="0" placeholder="VIPé¢å¤–åŠ æ¯">
                            <small style="color: #8c8c8c; font-size: 12px; display: block; margin-top: 4px;">åœ¨å¹´åŒ–æ”¶ç›Šç‡åŸºç¡€ä¸Šé¢å¤–å¢åŠ </small>
                        </div>
                        <div class="form-group">
                            <label>æ´»åŠ¨åŠ æ¯ (%)</label>
                            <input type="number" id="activityBonus" name="activity_bonus" step="0.01" min="0" max="10" value="0" placeholder="æ´»åŠ¨é¢å¤–åŠ æ¯">
                            <small style="color: #8c8c8c; font-size: 12px; display: block; margin-top: 4px;">æ´»åŠ¨æœŸé—´é¢å¤–åŠ æ¯</small>
                        </div>
                    </div>
                </div>

                <!-- è´­ä¹°é™åˆ¶ -->
                <div style="margin-bottom: 28px;">
                    <h3>è´­ä¹°é™åˆ¶</h3>
                    <div class="form-group">
                        <label>æœ€ä½VIPç­‰çº§è¦æ±‚</label>
                        <select id="minVipLevel" name="min_vip_level">
                            <option value="0">VIP0 - æ— é™åˆ¶</option>
                            <option value="1">VIP1 - å…¥é—¨æŠ•èµ„è€…</option>
                            <option value="2">VIP2 - ä¸­çº§æŠ•èµ„è€…</option>
                            <option value="3">VIP3 - é«˜çº§æŠ•èµ„è€…</option>
                            <option value="4">VIP4 - èµ„æ·±æŠ•èµ„è€…</option>
                            <option value="5">VIP5 - é»„é‡‘æŠ•èµ„è€…</option>
                            <option value="6">VIP6 - é“‚é‡‘æŠ•èµ„è€…</option>
                            <option value="7">VIP7 - é’»çŸ³æŠ•èµ„è€…</option>
                            <option value="8">VIP8 - è‡³å°ŠæŠ•èµ„è€…</option>
                        </select>
                        <small style="color: #8c8c8c; font-size: 12px; display: block; margin-top: 4px;">åªæœ‰è¾¾åˆ°æ­¤VIPç­‰çº§çš„ç”¨æˆ·æ‰èƒ½è´­ä¹°</small>
                    </div>
                </div>

                <div class="modal-footer" style="margin-top: 32px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn" onclick="closeProjectModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜é¡¹ç›®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å®åè®¤è¯è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="kycDetailModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <h2>å®åè®¤è¯è¯¦æƒ…</h2>
            <div id="kycDetailContent" style="padding: 20px 0;">
                <div style="text-align: center; padding: 40px;">åŠ è½½ä¸­...</div>
            </div>
            <div class="modal-footer" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn" onclick="closeKycDetailModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082/api';

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(pageId).classList.remove('hidden');
            event.target.classList.add('active');

            // åŠ è½½å¯¹åº”æ•°æ®
            if (pageId === 'users') loadUsers();
            if (pageId === 'projects') loadProjects();
            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'finance') loadFinance();
            if (pageId === 'kyc') loadKycList('pending');
            if (pageId === 'settings') loadSystemSettings();
            if (pageId === 'logs') loadLogs();
        }

        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers() {
            try {
                const res = await fetch(`${API_BASE}/user/list`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('userTableBody');
                    const kycStatusMap = {
                        'unverified': '<span style="color: #8c8c8c;">æœªè®¤è¯</span>',
                        'pending': '<span style="color: #faad14;">å¾…å®¡æ ¸</span>',
                        'verified': '<span style="color: #52c41a;">å·²è®¤è¯</span>',
                        'rejected': '<span style="color: #ff4d4f;">å·²æ‹’ç»</span>'
                    };
                    tbody.innerHTML = data.data.map(user => `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>VIP${user.vip_level || 0}</td>
                            <td>${kycStatusMap[user.kyc_status] || kycStatusMap['unverified']}</td>
                            <td>Â¥${(user.balance_cny || 0).toLocaleString()}</td>
                            <td>$${(user.balance_usdt || 0).toLocaleString()}</td>
                            <td>Â¥${(user.total_investment || 0).toLocaleString()}</td>
                            <td>${user.status === 'active' || user.status === 1 ? 'æ­£å¸¸' : 'å†»ç»“'}</td>
                            <td>
                                <button class="btn btn-primary" onclick="viewUserDetail(${user.id})" style="margin-right: 4px;">è¯¦æƒ…</button>
                                <button class="btn btn-primary" onclick="viewUserWalletLogs(${user.id})" style="margin-right: 4px;">èµ„é‡‘æµæ°´</button>
                                ${user.status === 'active' || user.status === 1
                                    ? `<button class="btn btn-danger" onclick="freezeUser(${user.id})">å†»ç»“</button>`
                                    : `<button class="btn btn-primary" onclick="unfreezeUser(${user.id})">è§£å†»</button>`
                                }
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
            }
        }

        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                const res = await fetch(`${API_BASE}/project/list`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('projectTableBody');
                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center;">æš‚æ— é¡¹ç›®</td></tr>';
                        return;
                    }
                    tbody.innerHTML = data.data.map(project => {
                        // æ ¼å¼åŒ–å¸ç§æ˜¾ç¤º
                        const currencies = project.currencies || [project.currency || 'CNY'];
                        const currencyText = currencies.length > 1 ? 'CNY+USDT' : currencies[0];

                        // è®¡ç®—æ€»é¢åº¦å’Œå·²å”®
                        const totalCNY = project.total_amount_cny || 0;
                        const totalUSDT = project.total_amount_usdt || 0;
                        const soldCNY = project.sold_amount_cny || 0;
                        const soldUSDT = project.sold_amount_usdt || 0;
                        const totalAmount = totalCNY + totalUSDT;
                        const soldAmount = soldCNY + soldUSDT;
                        const remainAmount = totalAmount - soldAmount;

                        // çŠ¶æ€æ˜¾ç¤º
                        const statusMap = {
                            'draft': '<span style="color: #8c8c8c;">è‰ç¨¿</span>',
                            'running': '<span style="color: #52c41a;">è¿›è¡Œä¸­</span>',
                            'paused': '<span style="color: #faad14;">å·²æš‚åœ</span>',
                            'completed': '<span style="color: #1890ff;">å·²å®Œæˆ</span>'
                        };
                        const statusText = statusMap[project.status] || project.status;

                        // æ“ä½œæŒ‰é’®
                        let actionButtons = `<button class="btn btn-primary" onclick="editProject(${project.id})" style="margin-right: 4px;">ç¼–è¾‘</button>`;
                        if (project.status === 'running') {
                            actionButtons += `<button class="btn btn-danger" onclick="pauseProject(${project.id})" style="margin-right: 4px;">æš‚åœ</button>`;
                        } else if (project.status === 'paused') {
                            actionButtons += `<button class="btn btn-primary" onclick="resumeProject(${project.id})" style="margin-right: 4px;">æ¢å¤</button>`;
                        }
                        if (project.status === 'draft') {
                            actionButtons += `<button class="btn btn-primary" onclick="startProject(${project.id})" style="margin-right: 4px;">å‘å¸ƒ</button>`;
                        }

                        return `
                            <tr>
                                <td>${project.id}</td>
                                <td>${project.name}</td>
                                <td>${project.annual_rate}%</td>
                                <td>${project.duration}</td>
                                <td>${currencyText}</td>
                                <td>${totalCNY > 0 ? 'Â¥' + totalCNY.toLocaleString() : ''} ${totalUSDT > 0 ? '$' + totalUSDT.toLocaleString() : ''}</td>
                                <td>${soldCNY > 0 ? 'Â¥' + soldCNY.toLocaleString() : ''} ${soldUSDT > 0 ? '$' + soldUSDT.toLocaleString() : ''}</td>
                                <td>${remainAmount > 0 ? (totalCNY > 0 ? 'Â¥' : '$') + remainAmount.toLocaleString() : '0'}</td>
                                <td>${statusText}</td>
                                <td>${actionButtons}</td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                document.getElementById('projectTableBody').innerHTML = '<tr><td colspan="10" style="text-align: center; color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }

        // åŠ è½½æ•°æ®æ¦‚è§ˆ
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_BASE}/admin/stats`);
                const data = await res.json();
                if (data.code === 1) {
                    const stats = data.data;
                    document.getElementById('totalUsers').textContent = stats.total_users || 0;
                    document.getElementById('activeUsers').textContent = stats.active_users || 0;
                    document.getElementById('totalInvestment').textContent = 'Â¥' + (stats.total_investment || 0).toLocaleString();
                    document.getElementById('todayRecharge').textContent = 'Â¥' + (stats.today_recharge || 0).toLocaleString();
                    document.getElementById('todayWithdraw').textContent = 'Â¥' + (stats.today_withdraw || 0).toLocaleString();
                    document.getElementById('pendingKyc').textContent = stats.pending_kyc || 0;
                    document.getElementById('pendingRecharge').textContent = stats.pending_recharge || 0;
                    document.getElementById('pendingWithdraw').textContent = stats.pending_withdraw || 0;
                    document.getElementById('totalRevenue').textContent = 'Â¥' + (stats.total_revenue || 0).toLocaleString();
                } else {
                    // å¦‚æœæ¥å£å¤±è´¥ï¼Œä½¿ç”¨æ—§æ–¹æ³•
                    const [usersRes, projectsRes] = await Promise.all([
                        fetch(`${API_BASE}/user/list`),
                        fetch(`${API_BASE}/project/list`)
                    ]);
                    const usersData = await usersRes.json();
                    const projectsData = await projectsRes.json();
                    if (usersData.code === 1) {
                        document.getElementById('totalUsers').textContent = usersData.data.length;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        // å†»ç»“ç”¨æˆ·
        async function freezeUser(userId) {
            if (!confirm('ç¡®å®šè¦å†»ç»“è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/user/freeze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('ç”¨æˆ·å·²å†»ç»“');
                    loadUsers();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // è§£å†»ç”¨æˆ·
        async function unfreezeUser(userId) {
            if (!confirm('ç¡®å®šè¦è§£å†»è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/user/unfreeze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('ç”¨æˆ·å·²è§£å†»');
                    loadUsers();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ›å»ºé¡¹ç›®
        function createProject() {
            document.getElementById('modalTitle').textContent = 'æ–°å»ºé¡¹ç›®';
            document.getElementById('projectForm').reset();
            document.getElementById('projectId').value = '';
            document.getElementById('projectModal').style.display = 'block';
        }

        // ç¼–è¾‘é¡¹ç›®
        async function editProject(projectId) {
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘é¡¹ç›®';
            document.getElementById('projectId').value = projectId;

            try {
                const res = await fetch(`${API_BASE}/project/detail?id=${projectId}`);
                const result = await res.json();
                if (result.code === 1) {
                    const project = result.data;

                    // å¡«å……è¡¨å•
                    document.getElementById('projectName').value = project.name || '';
                    document.getElementById('annualRate').value = project.annual_rate || 0;
                    document.getElementById('duration').value = project.duration || 0;
                    document.getElementById('description').value = project.description || '';

                    // å¸ç§é€‰æ‹©
                    const currencies = project.currencies || [project.currency || 'CNY'];
                    document.getElementById('currencyCNY').checked = currencies.includes('CNY');
                    document.getElementById('currencyUSDT').checked = currencies.includes('USDT');

                    // é¢åº¦è®¾ç½®
                    document.getElementById('totalAmountCNY').value = project.total_amount_cny || 0;
                    document.getElementById('totalAmountUSDT').value = project.total_amount_usdt || 0;
                    document.getElementById('minInvestmentCNY').value = project.min_investment_cny || 0;
                    document.getElementById('minInvestmentUSDT').value = project.min_investment_usdt || 0;

                    // è¿”åˆ©è®¾ç½®
                    document.getElementById('rebateCNY').value = project.rebate_cny || 0;
                    document.getElementById('rebateUSDT').value = project.rebate_usdt || 0;

                    // åŠ æ¯è®¾ç½®
                    document.getElementById('vipBonus').value = project.vip_bonus || 0;
                    document.getElementById('activityBonus').value = project.activity_bonus || 0;

                    // VIPé™åˆ¶
                    document.getElementById('minVipLevel').value = project.min_vip_level || 0;

                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    document.getElementById('projectModal').style.display = 'block';
                } else {
                    alert('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                alert('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeProjectModal() {
            document.getElementById('projectModal').style.display = 'none';
        }

        // æš‚åœé¡¹ç›®
        async function pauseProject(projectId) {
            if (!confirm('ç¡®å®šè¦æš‚åœè¯¥é¡¹ç›®å—ï¼Ÿæš‚åœåç”¨æˆ·å°†æ— æ³•ç»§ç»­æŠ•èµ„ã€‚')) return;
            try {
                const res = await fetch(`${API_BASE}/project/pause`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: projectId })
                });
                const result = await res.json();
                if (result.code === 1) {
                    alert('é¡¹ç›®å·²æš‚åœ');
                    loadProjects();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ¢å¤é¡¹ç›®
        async function resumeProject(projectId) {
            if (!confirm('ç¡®å®šè¦æ¢å¤è¯¥é¡¹ç›®å—ï¼Ÿæ¢å¤åç”¨æˆ·å¯ä»¥ç»§ç»­æŠ•èµ„ã€‚')) return;
            try {
                const res = await fetch(`${API_BASE}/project/resume`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: projectId })
                });
                const result = await res.json();
                if (result.code === 1) {
                    alert('é¡¹ç›®å·²æ¢å¤');
                    loadProjects();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // å‘å¸ƒé¡¹ç›®ï¼ˆå°†è‰ç¨¿çŠ¶æ€æ”¹ä¸ºè¿›è¡Œä¸­ï¼‰
        async function startProject(projectId) {
            if (!confirm('ç¡®å®šè¦å‘å¸ƒè¯¥é¡¹ç›®å—ï¼Ÿå‘å¸ƒåé¡¹ç›®å°†å¼€å§‹æ¥å—æŠ•èµ„ã€‚')) return;
            try {
                const res = await fetch(`${API_BASE}/project/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: projectId })
                });
                const result = await res.json();
                if (result.code === 1) {
                    alert('é¡¹ç›®å·²å‘å¸ƒ');
                    loadProjects();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æäº¤é¡¹ç›®è¡¨å•
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // è·å–é€‰ä¸­çš„å¸ç§
            const currencies = [];
            if (document.getElementById('currencyCNY').checked) currencies.push('CNY');
            if (document.getElementById('currencyUSDT').checked) currencies.push('USDT');

            if (currencies.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§å¸ç§ï¼');
                return;
            }

            // æ„å»ºæ•°æ®å¯¹è±¡
            const data = {
                id: document.getElementById('projectId').value || null,
                name: document.getElementById('projectName').value,
                annual_rate: parseFloat(document.getElementById('annualRate').value),
                duration: parseInt(document.getElementById('duration').value),
                description: document.getElementById('description').value || '',
                currencies: currencies,
                total_amount_cny: parseFloat(document.getElementById('totalAmountCNY').value) || 0,
                total_amount_usdt: parseFloat(document.getElementById('totalAmountUSDT').value) || 0,
                min_investment_cny: parseFloat(document.getElementById('minInvestmentCNY').value) || 0,
                min_investment_usdt: parseFloat(document.getElementById('minInvestmentUSDT').value) || 0,
                rebate_cny: parseFloat(document.getElementById('rebateCNY').value) || 0,
                rebate_usdt: parseFloat(document.getElementById('rebateUSDT').value) || 0,
                vip_bonus: parseFloat(document.getElementById('vipBonus').value) || 0,
                activity_bonus: parseFloat(document.getElementById('activityBonus').value) || 0,
                min_vip_level: parseInt(document.getElementById('minVipLevel').value) || 0
            };

            const projectId = data.id;
            const url = projectId ? `${API_BASE}/project/update` : `${API_BASE}/project/create`;
            const method = projectId ? 'PUT' : 'POST';

            try {
                const res = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.code === 1) {
                    alert('ä¿å­˜æˆåŠŸï¼');
                    closeProjectModal();
                    loadProjects();
                } else {
                    alert('ä¿å­˜å¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const projectModal = document.getElementById('projectModal');
            const kycModal = document.getElementById('kycDetailModal');
            if (event.target == projectModal) {
                closeProjectModal();
            }
            if (event.target == kycModal) {
                closeKycDetailModal();
            }
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ')) {
                window.location.href = 'login.html';
            }
        }

        // åŠ è½½è´¢åŠ¡ç®¡ç†æ•°æ®
        async function loadFinance() {
            await loadRecharges();
            await loadWithdraws();
        }

        // åŠ è½½å®åè®¤è¯å®¡æ ¸åˆ—è¡¨
        async function loadKycList(status = 'pending') {
            try {
                const res = await fetch(`${API_BASE}/kyc/list?status=${status}`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('kycTableBody');
                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
                    } else {
                        const statusMap = {
                            'pending': '<span style="color: #faad14;">å¾…å®¡æ ¸</span>',
                            'approved': '<span style="color: #52c41a;">å·²é€šè¿‡</span>',
                            'rejected': '<span style="color: #ff4d4f;">å·²æ‹’ç»</span>'
                        };
                        tbody.innerHTML = data.data.map(kyc => {
                            const idCardMasked = kyc.id_card ? kyc.id_card.substring(0, 6) + '****' + kyc.id_card.substring(14) : '';
                            let actions = '';
                            if (status === 'pending') {
                                actions = `
                                    <button class="btn btn-primary" onclick="viewKycDetail(${kyc.id})" style="margin-right: 4px;">æŸ¥çœ‹</button>
                                    <button class="btn btn-primary" onclick="approveKyc(${kyc.id})" style="margin-right: 4px;">é€šè¿‡</button>
                                    <button class="btn btn-danger" onclick="rejectKyc(${kyc.id})">æ‹’ç»</button>
                                `;
                            } else {
                                actions = `<button class="btn btn-primary" onclick="viewKycDetail(${kyc.id})">æŸ¥çœ‹è¯¦æƒ…</button>`;
                            }
                            return `
                                <tr>
                                    <td>${kyc.id}</td>
                                    <td>${kyc.user_id}</td>
                                    <td>${kyc.username || 'æœªçŸ¥'}</td>
                                    <td>${kyc.realname || ''}</td>
                                    <td>${idCardMasked}</td>
                                    <td>${kyc.create_time || ''}</td>
                                    <td>${statusMap[status] || status}</td>
                                    <td>${actions}</td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å®åè®¤è¯åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('kycTableBody').innerHTML = '<tr><td colspan="8" style="text-align: center; color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }

        // æŸ¥çœ‹å®åè®¤è¯è¯¦æƒ…
        async function viewKycDetail(kycId) {
            try {
                const res = await fetch(`${API_BASE}/kyc/detail?id=${kycId}`);
                const data = await res.json();
                if (data.code === 1) {
                    const kyc = data.data;
                    const content = document.getElementById('kycDetailContent');
                    content.innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                            <div>
                                <div style="margin-bottom: 12px;"><strong>ç”¨æˆ·ID:</strong> ${kyc.user_id}</div>
                                <div style="margin-bottom: 12px;"><strong>ç”¨æˆ·å:</strong> ${kyc.username || 'æœªçŸ¥'}</div>
                                <div style="margin-bottom: 12px;"><strong>çœŸå®å§“å:</strong> ${kyc.realname || ''}</div>
                                <div style="margin-bottom: 12px;"><strong>èº«ä»½è¯å·:</strong> ${kyc.id_card || ''}</div>
                                <div style="margin-bottom: 12px;"><strong>æäº¤æ—¶é—´:</strong> ${kyc.create_time || ''}</div>
                                ${kyc.reject_reason ? `<div style="margin-bottom: 12px; color: #ff4d4f;"><strong>æ‹’ç»åŸå› :</strong> ${kyc.reject_reason}</div>` : ''}
                            </div>
                            <div>
                                ${kyc.face_photo ? `
                                    <div style="margin-bottom: 16px;">
                                        <strong>äººè„¸ç…§ç‰‡:</strong>
                                        <div style="margin-top: 8px;">
                                            <img src="${kyc.face_photo}" style="max-width: 100%; border: 1px solid #d9d9d9; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                        </div>
                                    </div>
                                ` : '<div style="color: #8c8c8c;">æœªä¸Šä¼ äººè„¸ç…§ç‰‡</div>'}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <strong>èº«ä»½è¯æ­£é¢:</strong>
                                ${kyc.id_card_front ? `
                                    <div style="margin-top: 8px;">
                                        <img src="${kyc.id_card_front}" style="max-width: 100%; border: 1px solid #d9d9d9; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    </div>
                                ` : '<div style="margin-top: 8px; color: #8c8c8c;">æœªä¸Šä¼ </div>'}
                            </div>
                            <div>
                                <strong>èº«ä»½è¯åé¢:</strong>
                                ${kyc.id_card_back ? `
                                    <div style="margin-top: 8px;">
                                        <img src="${kyc.id_card_back}" style="max-width: 100%; border: 1px solid #d9d9d9; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    </div>
                                ` : '<div style="margin-top: 8px; color: #8c8c8c;">æœªä¸Šä¼ </div>'}
                            </div>
                        </div>
                        ${kyc.status === 'pending' ? `
                            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: center; gap: 12px;">
                                <button class="btn btn-primary" onclick="approveKycFromDetail(${kyc.id})">å®¡æ ¸é€šè¿‡</button>
                                <button class="btn btn-danger" onclick="rejectKycFromDetail(${kyc.id})">å®¡æ ¸æ‹’ç»</button>
                            </div>
                        ` : ''}
                    `;
                    document.getElementById('kycDetailModal').style.display = 'block';
                } else {
                    alert('åŠ è½½è¯¦æƒ…å¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('åŠ è½½è¯¦æƒ…å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
        function closeKycDetailModal() {
            document.getElementById('kycDetailModal').style.display = 'none';
        }

        // ä»è¯¦æƒ…é¡µå®¡æ ¸é€šè¿‡
        async function approveKycFromDetail(kycId) {
            if (!confirm('ç¡®å®šè¦é€šè¿‡è¯¥å®åè®¤è¯å—ï¼Ÿ')) return;
            await approveKyc(kycId);
            closeKycDetailModal();
        }

        // ä»è¯¦æƒ…é¡µå®¡æ ¸æ‹’ç»
        async function rejectKycFromDetail(kycId) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
            if (!reason) return;
            await rejectKyc(kycId, reason);
            closeKycDetailModal();
        }

        // å®¡æ ¸é€šè¿‡å®åè®¤è¯
        async function approveKyc(kycId) {
            if (!confirm('ç¡®å®šè¦é€šè¿‡è¯¥å®åè®¤è¯å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/kyc/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: kycId })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('å®¡æ ¸é€šè¿‡');
                    loadKycList('pending');
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // å®¡æ ¸æ‹’ç»å®åè®¤è¯
        async function rejectKyc(kycId, reason = null) {
            if (!reason) {
                reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
                if (!reason) return;
            }
            try {
                const res = await fetch(`${API_BASE}/kyc/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: kycId, reason: reason })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('å·²æ‹’ç»');
                    loadKycList('pending');
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½å……å€¼åˆ—è¡¨
        async function loadRecharges() {
            try {
                const res = await fetch(`${API_BASE}/finance/recharge/list?status=pending`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('rechargeTableBody');
                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">æš‚æ— å¾…å®¡æ ¸å……å€¼</td></tr>';
                    } else {
                        tbody.innerHTML = data.data.map(r => {
                            const paymentMethod = r.payment_method || 'æœªçŸ¥';
                            const needsReview = paymentMethod.includes('é“¶è¡Œå¡') || paymentMethod.includes('è½¬è´¦');
                            const statusText = needsReview ? '<span style="color: #faad14;">å¾…å®¡æ ¸</span>' : '<span style="color: #52c41a;">è‡ªåŠ¨åˆ°è´¦</span>';

                            let actionButtons = '';
                            if (needsReview) {
                                actionButtons = `
                                    <button class="btn btn-primary" onclick="viewRechargeDetail(${r.id})" style="margin-right: 4px;">æŸ¥çœ‹å‡­è¯</button>
                                    <button class="btn btn-primary" onclick="approveRecharge(${r.id})" style="margin-right: 4px;">é€šè¿‡</button>
                                    <button class="btn btn-danger" onclick="rejectRecharge(${r.id})">æ‹’ç»</button>
                                `;
                            } else {
                                actionButtons = '<span style="color: #999;">è‡ªåŠ¨å¤„ç†</span>';
                            }

                            return `
                                <tr>
                                    <td>${r.id}</td>
                                    <td>${r.username || 'æœªçŸ¥'} (ID: ${r.user_id})</td>
                                    <td>${paymentMethod}</td>
                                    <td>${r.currency === 'CNY' ? 'Â¥' : '$'}${r.amount.toLocaleString()}</td>
                                    <td>${r.currency}</td>
                                    <td style="font-size: 12px; color: #999;">${r.transaction_id || '-'}</td>
                                    <td>${r.create_time || '-'}</td>
                                    <td>${statusText}</td>
                                    <td>${actionButtons}</td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å……å€¼åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('rechargeTableBody').innerHTML = '<tr><td colspan="9" style="text-align: center; color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }

        // åŠ è½½æç°åˆ—è¡¨
        async function loadWithdraws() {
            try {
                const res = await fetch(`${API_BASE}/finance/withdraw/list?status=pending`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('withdrawTableBody');
                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">æš‚æ— å¾…å®¡æ ¸æç°</td></tr>';
                    } else {
                        tbody.innerHTML = data.data.map(w => {
                            const withdrawMethod = w.withdraw_method || w.payment_method || 'é“¶è¡Œå¡';
                            const accountInfo = w.account_number || w.bank_account || w.usdt_address || '-';

                            return `
                                <tr>
                                    <td>${w.id}</td>
                                    <td>${w.username || 'æœªçŸ¥'} (ID: ${w.user_id})</td>
                                    <td>${withdrawMethod}</td>
                                    <td>${w.currency === 'CNY' ? 'Â¥' : '$'}${w.amount.toLocaleString()}</td>
                                    <td>${w.currency}</td>
                                    <td style="font-size: 12px; color: #666; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${accountInfo}</td>
                                    <td>${w.create_time || '-'}</td>
                                    <td><span style="color: #faad14;">å¾…å®¡æ ¸</span></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="viewWithdrawDetail(${w.id})" style="margin-right: 4px;">è¯¦æƒ…</button>
                                        <button class="btn btn-primary" onclick="approveWithdraw(${w.id})" style="margin-right: 4px;">é€šè¿‡</button>
                                        <button class="btn btn-danger" onclick="rejectWithdraw(${w.id})">æ‹’ç»</button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½æç°åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('withdrawTableBody').innerHTML = '<tr><td colspan="9" style="text-align: center; color: #ff4d4f;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }

        // å®¡æ ¸é€šè¿‡æç°
        async function approveWithdraw(withdrawId) {
            if (!confirm('ç¡®å®šè¦é€šè¿‡è¯¥æç°ç”³è¯·å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/finance/withdraw/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ withdraw_id: withdrawId })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('æç°å®¡æ ¸é€šè¿‡');
                    loadWithdraws();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ‹’ç»æç°
        async function rejectWithdraw(withdrawId) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
            if (!reason) return;
            try {
                const res = await fetch(`${API_BASE}/finance/withdraw/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ withdraw_id: withdrawId, reason: reason })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('æç°å·²æ‹’ç»');
                    loadWithdraws();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æŸ¥çœ‹å……å€¼è¯¦æƒ…ï¼ˆå«å‡­è¯ï¼‰
        async function viewRechargeDetail(rechargeId) {
            try {
                const res = await fetch(`${API_BASE}/finance/recharge/detail?id=${rechargeId}`);
                const data = await res.json();
                if (data.code === 1) {
                    const r = data.data;
                    const paymentMethod = r.payment_method || 'æœªçŸ¥';
                    const needsReview = paymentMethod.includes('é“¶è¡Œå¡') || paymentMethod.includes('è½¬è´¦');

                    let voucherHtml = '';
                    if (r.voucher_image || r.proof_image) {
                        const imageUrl = r.voucher_image || r.proof_image;
                        voucherHtml = `
                            <div style="margin-bottom: 16px;">
                                <strong>è½¬è´¦å‡­è¯ï¼š</strong>
                                <div style="margin-top: 8px;">
                                    <img src="${imageUrl}" style="max-width: 100%; max-height: 400px; border: 1px solid #d9d9d9; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="è½¬è´¦å‡­è¯">
                                </div>
                            </div>
                        `;
                    } else if (needsReview) {
                        voucherHtml = '<div style="color: #ff4d4f; margin-bottom: 16px;">âš ï¸ æœªä¸Šä¼ è½¬è´¦å‡­è¯</div>';
                    }

                    const detailHtml = `
                        <div style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                                <div>
                                    <div style="margin-bottom: 12px;"><strong>å……å€¼ID:</strong> ${r.id}</div>
                                    <div style="margin-bottom: 12px;"><strong>ç”¨æˆ·:</strong> ${r.username || 'æœªçŸ¥'} (ID: ${r.user_id})</div>
                                    <div style="margin-bottom: 12px;"><strong>å……å€¼æ–¹å¼:</strong> ${paymentMethod}</div>
                                    <div style="margin-bottom: 12px;"><strong>é‡‘é¢:</strong> ${r.currency === 'CNY' ? 'Â¥' : '$'}${r.amount.toLocaleString()}</div>
                                    <div style="margin-bottom: 12px;"><strong>å¸ç§:</strong> ${r.currency}</div>
                                </div>
                                <div>
                                    <div style="margin-bottom: 12px;"><strong>äº¤æ˜“å•å·:</strong> ${r.transaction_id || '-'}</div>
                                    <div style="margin-bottom: 12px;"><strong>æäº¤æ—¶é—´:</strong> ${r.create_time || '-'}</div>
                                    <div style="margin-bottom: 12px;"><strong>çŠ¶æ€:</strong> ${r.status === 'pending' ? 'å¾…å®¡æ ¸' : r.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'}</div>
                                    ${r.reject_reason ? `<div style="margin-bottom: 12px; color: #ff4d4f;"><strong>æ‹’ç»åŸå› :</strong> ${r.reject_reason}</div>` : ''}
                                </div>
                            </div>
                            ${voucherHtml}
                            ${needsReview && r.status === 'pending' ? `
                                <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: center; gap: 12px;">
                                    <button class="btn btn-primary" onclick="approveRechargeFromDetail(${r.id})">å®¡æ ¸é€šè¿‡</button>
                                    <button class="btn btn-danger" onclick="rejectRechargeFromDetail(${r.id})">å®¡æ ¸æ‹’ç»</button>
                                </div>
                            ` : ''}
                            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end;">
                                <button class="btn" onclick="closeRechargeDetailModal()">å…³é—­</button>
                            </div>
                        </div>
                    `;
                    showModal('å……å€¼è¯¦æƒ…', detailHtml);
                } else {
                    alert('åŠ è½½å……å€¼è¯¦æƒ…å¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('åŠ è½½å……å€¼è¯¦æƒ…å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä»è¯¦æƒ…é¡µå®¡æ ¸é€šè¿‡
        async function approveRechargeFromDetail(rechargeId) {
            if (!confirm('ç¡®å®šè¦é€šè¿‡è¯¥å……å€¼ç”³è¯·å—ï¼Ÿ')) return;
            await approveRecharge(rechargeId);
            closeRechargeDetailModal();
        }

        // ä»è¯¦æƒ…é¡µå®¡æ ¸æ‹’ç»
        async function rejectRechargeFromDetail(rechargeId) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
            if (!reason) return;
            await rejectRecharge(rechargeId, reason);
            closeRechargeDetailModal();
        }

        // å…³é—­å……å€¼è¯¦æƒ…æ¨¡æ€æ¡†
        function closeRechargeDetailModal() {
            closeUserDetailModal();
        }

        // å®¡æ ¸é€šè¿‡å……å€¼
        async function approveRecharge(rechargeId) {
            if (!confirm('ç¡®å®šè¦é€šè¿‡è¯¥å……å€¼ç”³è¯·å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/finance/recharge/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ recharge_id: rechargeId })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('å……å€¼å®¡æ ¸é€šè¿‡');
                    loadRecharges();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // å®¡æ ¸æ‹’ç»å……å€¼
        async function rejectRecharge(rechargeId, reason = null) {
            if (!reason) {
                reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
                if (!reason) return;
            }
            try {
                const res = await fetch(`${API_BASE}/finance/recharge/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ recharge_id: rechargeId, reason: reason })
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('å……å€¼å·²æ‹’ç»');
                    loadRecharges();
                } else {
                    alert('æ“ä½œå¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æŸ¥çœ‹æç°è¯¦æƒ…
        async function viewWithdrawDetail(withdrawId) {
            try {
                const res = await fetch(`${API_BASE}/finance/withdraw/detail?id=${withdrawId}`);
                const data = await res.json();
                if (data.code === 1) {
                    const w = data.data;
                    const detailHtml = `
                        <div style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                                <div>
                                    <div style="margin-bottom: 12px;"><strong>æç°ID:</strong> ${w.id}</div>
                                    <div style="margin-bottom: 12px;"><strong>ç”¨æˆ·:</strong> ${w.username || 'æœªçŸ¥'} (ID: ${w.user_id})</div>
                                    <div style="margin-bottom: 12px;"><strong>æç°æ–¹å¼:</strong> ${w.withdraw_method || w.payment_method || 'é“¶è¡Œå¡'}</div>
                                    <div style="margin-bottom: 12px;"><strong>é‡‘é¢:</strong> ${w.currency === 'CNY' ? 'Â¥' : '$'}${w.amount.toLocaleString()}</div>
                                    <div style="margin-bottom: 12px;"><strong>å¸ç§:</strong> ${w.currency}</div>
                                </div>
                                <div>
                                    <div style="margin-bottom: 12px;"><strong>æ”¶æ¬¾è´¦æˆ·:</strong> ${w.account_number || w.bank_account || w.usdt_address || '-'}</div>
                                    <div style="margin-bottom: 12px;"><strong>ç”³è¯·æ—¶é—´:</strong> ${w.create_time || '-'}</div>
                                    <div style="margin-bottom: 12px;"><strong>çŠ¶æ€:</strong> ${w.status === 'pending' ? 'å¾…å®¡æ ¸' : w.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'}</div>
                                    ${w.reject_reason ? `<div style="margin-bottom: 12px; color: #ff4d4f;"><strong>æ‹’ç»åŸå› :</strong> ${w.reject_reason}</div>` : ''}
                                </div>
                            </div>
                            ${w.status === 'pending' ? `
                                <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: center; gap: 12px;">
                                    <button class="btn btn-primary" onclick="approveWithdraw(${w.id}); closeRechargeDetailModal();">å®¡æ ¸é€šè¿‡</button>
                                    <button class="btn btn-danger" onclick="rejectWithdraw(${w.id}); closeRechargeDetailModal();">å®¡æ ¸æ‹’ç»</button>
                                </div>
                            ` : ''}
                            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end;">
                                <button class="btn" onclick="closeRechargeDetailModal()">å…³é—­</button>
                            </div>
                        </div>
                    `;
                    showModal('æç°è¯¦æƒ…', detailHtml);
                } else {
                    alert('åŠ è½½æç°è¯¦æƒ…å¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('åŠ è½½æç°è¯¦æƒ…å¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½VIPé…ç½®
        async function loadVipConfig() {
            try {
                const res = await fetch(`${API_BASE}/vip/config`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('vipTableBody');
                    tbody.innerHTML = data.data.map(vip => `
                        <tr>
                            <td>VIP${vip.level}</td>
                            <td>${vip.name}</td>
                            <td>Â¥${(vip.min_investment || 0).toLocaleString()}</td>
                            <td>${((vip.interest_bonus || 0) * 100).toFixed(2)}%</td>
                            <td>${vip.direct_rebate || 0}%</td>
                            <td>${vip.team_rebate || 0}%</td>
                            <td>${vip.sign_points || 0}</td>
                            <td>
                                <button class="btn btn-primary" onclick="editVipConfig(${vip.level})">ç¼–è¾‘</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½VIPé…ç½®å¤±è´¥:', error);
            }
        }

        // ä¿å­˜æ‰€æœ‰VIPé…ç½®
        async function saveAllVipConfig() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜æ‰€æœ‰VIPé…ç½®å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/vip/config`);
                const data = await res.json();
                if (data.code === 1) {
                    const res2 = await fetch(`${API_BASE}/vip/update-config`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ configs: data.data })
                    });
                    const result = await res2.json();
                    if (result.code === 1) {
                        alert('VIPé…ç½®ä¿å­˜æˆåŠŸ');
                    } else {
                        alert('ä¿å­˜å¤±è´¥ï¼š' + result.msg);
                    }
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // ç¼–è¾‘VIPé…ç½®
        async function editVipConfig(level) {
            try {
                const res = await fetch(`${API_BASE}/vip/config`);
                const data = await res.json();
                if (data.code === 1) {
                    const vip = data.data.find(v => v.level === level);
                    if (!vip) {
                        alert('æœªæ‰¾åˆ°VIP' + level + 'é…ç½®');
                        return;
                    }
                    const formHtml = `
                        <div style="padding: 20px; max-height: 80vh; overflow-y: auto;">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>VIPåç§°:</strong></label>
                                <input type="text" id="vipName" value="${vip.name}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ç´¯è®¡æŠ•èµ„é¢ (Â¥):</strong> <span style="color: #999; font-size: 12px;">è¾¾åˆ°è¯¥ç­‰çº§éœ€è¦ç´¯è®¡æŠ•èµ„çš„æ€»é‡‘é¢</span></label>
                                <input type="number" id="vipMinInvestment" value="${vip.min_investment || 0}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>é¢å¤–åŠ æ¯ (%):</strong> <span style="color: #999; font-size: 12px;">è´­ä¹°é¡¹ç›®æ—¶å¯äº«å—çš„é¢å¤–å¹´åŒ–æ”¶ç›Šç‡åŠ æˆ</span></label>
                                <input type="number" id="vipInterestBonus" value="${((vip.interest_bonus || 0) * 100).toFixed(2)}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ä¸€çº§è¿”åˆ© (%):</strong> <span style="color: #999; font-size: 12px;">é‚€è¯·å¥½å‹æŠ•èµ„ï¼Œå¯è·å¾—çš„ä¸€çº§è¿”åˆ©ç™¾åˆ†æ¯”</span></label>
                                <input type="number" id="vipDirectRebate" value="${vip.direct_rebate || 0}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>äºŒçº§è¿”åˆ© (%):</strong> <span style="color: #999; font-size: 12px;">é‚€è¯·å¥½å‹çš„é‚€è¯·å¥½å‹æŠ•èµ„ï¼Œå¯è·å¾—çš„äºŒçº§è¿”åˆ©ç™¾åˆ†æ¯”</span></label>
                                <input type="number" id="vipTeamRebate" value="${vip.team_rebate || 0}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ç­¾åˆ°ç§¯åˆ†:</strong> <span style="color: #999; font-size: 12px;">æ¯å¤©ç­¾åˆ°å¯è·å¾—çš„å›ºå®šç§¯åˆ†</span></label>
                                <input type="number" id="vipSignPoints" value="${vip.sign_points || 0}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>æè¿°:</strong></label>
                                <textarea id="vipDescription" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; min-height: 80px; background: white; color: #333;">${vip.description || ''}</textarea>
                            </div>
                            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end; gap: 12px;">
                                <button class="btn" onclick="closeVipEditModal()">å–æ¶ˆ</button>
                                <button class="btn btn-primary" onclick="saveVipConfig(${level})">ä¿å­˜</button>
                            </div>
                        </div>
                    `;
                    showModal('ç¼–è¾‘VIP' + level + 'é…ç½®', formHtml);
                }
            } catch (error) {
                alert('åŠ è½½VIPé…ç½®å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¿å­˜VIPé…ç½®
        async function saveVipConfig(level) {
            const config = {
                level: level,
                name: document.getElementById('vipName').value,
                min_investment: parseFloat(document.getElementById('vipMinInvestment').value) || 0,
                interest_bonus: parseFloat(document.getElementById('vipInterestBonus').value) / 100 || 0,
                direct_rebate: parseFloat(document.getElementById('vipDirectRebate').value) || 0,
                team_rebate: parseFloat(document.getElementById('vipTeamRebate').value) || 0,
                sign_points: parseInt(document.getElementById('vipSignPoints').value) || 0,
                description: document.getElementById('vipDescription').value
            };

            try {
                const res = await fetch(`${API_BASE}/vip/config`);
                const data = await res.json();
                if (data.code === 1) {
                    const configs = data.data.map(v => {
                        if (v.level === level) {
                            return config;
                        }
                        return v;
                    });
                    const res2 = await fetch(`${API_BASE}/vip/update-config`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ configs: configs })
                    });
                    const result = await res2.json();
                    if (result.code === 1) {
                        alert('VIPé…ç½®ä¿å­˜æˆåŠŸ');
                        closeVipEditModal();
                        loadVipConfig();
                    } else {
                        alert('ä¿å­˜å¤±è´¥ï¼š' + result.msg);
                    }
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­VIPç¼–è¾‘æ¨¡æ€æ¡†
        function closeVipEditModal() {
            closeUserDetailModal();
        }

        // åŠ è½½å›¢é˜Ÿç®¡ç†å¥–é…ç½®
        async function loadTeamRewardConfig() {
            try {
                const res = await fetch(`${API_BASE}/team/reward-config`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('teamRewardTableBody');
                    tbody.innerHTML = data.data.map(config => `
                        <tr>
                            <td>${config.id}</td>
                            <td>${config.member_count}äºº</td>
                            <td>Â¥${config.total_investment.toLocaleString()}</td>
                            <td>${config.reward_points.toLocaleString()}</td>
                            <td>
                                <button class="btn btn-primary" onclick="editTeamRewardConfig(${config.id})">ç¼–è¾‘</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½å›¢é˜Ÿç®¡ç†å¥–é…ç½®å¤±è´¥:', error);
            }
        }

        // ç¼–è¾‘å›¢é˜Ÿç®¡ç†å¥–é…ç½®
        async function editTeamRewardConfig(id) {
            try {
                const res = await fetch(`${API_BASE}/team/reward-config`);
                const data = await res.json();
                if (data.code === 1) {
                    const config = data.data.find(c => c.id === id);
                    if (!config) {
                        alert('æœªæ‰¾åˆ°é…ç½®');
                        return;
                    }
                    const formHtml = `
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ä¸‹çº§æˆå‘˜æ•°:</strong></label>
                                <input type="number" id="teamMemberCount" value="${config.member_count}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ç´¯è®¡æŠ•èµ„ (Â¥):</strong></label>
                                <input type="number" id="teamTotalInvestment" value="${config.total_investment}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px;"><strong>å¥–åŠ±ç§¯åˆ†:</strong></label>
                                <input type="number" id="teamRewardPoints" value="${config.reward_points}" style="width: 100%; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px; background: white; color: #333;">
                            </div>
                            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end; gap: 12px;">
                                <button class="btn" onclick="closeTeamRewardModal()">å–æ¶ˆ</button>
                                <button class="btn btn-primary" onclick="saveTeamRewardConfigItem(${id})">ä¿å­˜</button>
                            </div>
                        </div>
                    `;
                    showModal('ç¼–è¾‘å›¢é˜Ÿç®¡ç†å¥–é…ç½®', formHtml);
                }
            } catch (error) {
                alert('åŠ è½½é…ç½®å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¿å­˜å›¢é˜Ÿç®¡ç†å¥–é…ç½®é¡¹
        async function saveTeamRewardConfigItem(id) {
            // è¿™é‡Œåº”è¯¥æ›´æ–°é…ç½®å¹¶ä¿å­˜
            alert('ä¿å­˜åŠŸèƒ½å¾…å®ç°');
            closeTeamRewardModal();
        }

        // ä¿å­˜æ‰€æœ‰å›¢é˜Ÿç®¡ç†å¥–é…ç½®
        async function saveTeamRewardConfig() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜æ‰€æœ‰å›¢é˜Ÿç®¡ç†å¥–é…ç½®å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${API_BASE}/team/reward-config`);
                const data = await res.json();
                if (data.code === 1) {
                    const res2 = await fetch(`${API_BASE}/team/reward-config`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ configs: data.data })
                    });
                    const result = await res2.json();
                    if (result.code === 1) {
                        alert('å›¢é˜Ÿç®¡ç†å¥–é…ç½®ä¿å­˜æˆåŠŸ');
                        loadTeamRewardConfig();
                    } else {
                        alert('ä¿å­˜å¤±è´¥ï¼š' + result.msg);
                    }
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­å›¢é˜Ÿç®¡ç†å¥–ç¼–è¾‘æ¨¡æ€æ¡†
        function closeTeamRewardModal() {
            closeUserDetailModal();
        }

        // ç³»ç»Ÿè®¾ç½® - æ ‡ç­¾åˆ‡æ¢
        function switchSettingsTab(tab) {
            // éšè—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.settings-panel').forEach(p => p.classList.add('hidden'));
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            document.querySelectorAll('[id^="tab"]').forEach(t => t.classList.remove('btn-primary'));
            // æ˜¾ç¤ºé€‰ä¸­é¢æ¿
            const panelId = 'settings' + tab.charAt(0).toUpperCase() + tab.slice(1);
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.classList.remove('hidden');
                document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('btn-primary');
            }
        }

        // åŠ è½½ç³»ç»Ÿé…ç½®
        async function loadAllSettings() {
            try {
                const res = await fetch(`${API_BASE}/system/config`);
                const data = await res.json();
                if (data.code === 1) {
                    const config = data.data;

                    // æ±‡ç‡
                    if (config.exchange_rate) {
                        document.getElementById('exchangeRate').value = config.exchange_rate.usdt_to_cny || 7.2;
                    }

                    // VIPé…ç½®
                    if (config.vip_config) {
                        renderVipConfigTable(config.vip_config);
                    }

                    // å›¢é˜Ÿå¥–åŠ±é…ç½®
                    if (config.team_reward_config) {
                        renderTeamRewardTable(config.team_reward_config);
                    }

                    // ä½“éªŒé‡‘
                    if (config.trial_money) {
                        document.getElementById('trialAmountCny').value = config.trial_money.amount_cny || 888;
                        document.getElementById('trialAmountUsdt').value = config.trial_money.amount_usdt || 123;
                        document.getElementById('trialDuration').value = config.trial_money.duration_days || 7;
                        document.getElementById('trialRequireKyc').value = config.trial_money.require_kyc ? 1 : 0;
                        document.getElementById('trialRequirePayment').value = config.trial_money.require_bind_payment ? 1 : 0;
                        document.getElementById('trialOnePerUser').value = config.trial_money.one_per_user ? 1 : 0;
                        document.getElementById('trialDescription').value = config.trial_money.description || '';
                    }

                    // æŠ•èµ„é…ç½®
                    if (config.investment) {
                        document.getElementById('investMinCny').value = config.investment.min_amount_cny || 1000;
                        document.getElementById('investMaxCny').value = config.investment.max_amount_cny || 1000000;
                        document.getElementById('investMinUsdt').value = config.investment.min_amount_usdt || 100;
                        document.getElementById('investMaxUsdt').value = config.investment.max_amount_usdt || 100000;
                        document.getElementById('investRequireKyc').value = config.investment.require_kyc ? 1 : 0;
                        document.getElementById('investRequirePayment').value = config.investment.require_bind_payment ? 1 : 0;
                    }

                    // å……å€¼é…ç½®
                    if (config.recharge) {
                        if (config.recharge.cny) {
                            document.getElementById('rechargeMinCny').value = config.recharge.cny.min_amount || 100;
                            document.getElementById('rechargeMaxCny').value = config.recharge.cny.max_amount || 500000;
                            document.getElementById('rechargeFeeRateCny').value = (config.recharge.cny.fee_rate || 0) * 100;
                        }
                        if (config.recharge.usdt) {
                            document.getElementById('rechargeMinUsdt').value = config.recharge.usdt.min_amount || 10;
                            document.getElementById('rechargeMaxUsdt').value = config.recharge.usdt.max_amount || 50000;
                            document.getElementById('rechargeFeeRateUsdt').value = (config.recharge.usdt.fee_rate || 0) * 100;
                        }
                    }

                    // æç°é…ç½®
                    if (config.withdrawal) {
                        if (config.withdrawal.cny) {
                            document.getElementById('withdrawMinCny').value = config.withdrawal.cny.min_amount || 100;
                            document.getElementById('withdrawMaxCny').value = config.withdrawal.cny.max_amount || 500000;
                            document.getElementById('withdrawFeeRateCny').value = (config.withdrawal.cny.fee_rate || 0.005) * 100;
                            document.getElementById('withdrawDailyLimitCny').value = config.withdrawal.cny.daily_limit || 50000;
                        }
                        if (config.withdrawal.usdt) {
                            document.getElementById('withdrawMinUsdt').value = config.withdrawal.usdt.min_amount || 10;
                            document.getElementById('withdrawMaxUsdt').value = config.withdrawal.usdt.max_amount || 50000;
                            document.getElementById('withdrawFeeRateUsdt').value = (config.withdrawal.usdt.fee_rate || 0.005) * 100;
                            document.getElementById('withdrawDailyLimitUsdt').value = config.withdrawal.usdt.daily_limit || 5000;
                        }
                    }

                    // æ—¥åˆ©å®é…ç½®
                    if (config.ribao) {
                        document.getElementById('ribaoRateCny').value = config.ribao.daily_interest_rate_cny || 0.0005;
                        document.getElementById('ribaoRateUsdt').value = config.ribao.daily_interest_rate_usdt || 0.0005;
                        document.getElementById('ribaoMinCny').value = config.ribao.min_amount_cny || 100;
                        document.getElementById('ribaoMinUsdt').value = config.ribao.min_amount_usdt || 10;
                        document.getElementById('ribaoSettleTime').value = config.ribao.settle_time || 'æ¯æ—¥19:00';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç³»ç»Ÿè®¾ç½®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“VIPé…ç½®è¡¨æ ¼
        function renderVipConfigTable(vipConfig) {
            const html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 80px;">ç­‰çº§</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">åç§°</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">æœ€ä½æŠ•èµ„(CNY)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">æœ€ä½æŠ•èµ„(USDT)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">åŠ æ¯(CNY)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">åŠ æ¯(USDT)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">ç›´æ¨è¿”åˆ©(CNY)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">ç›´æ¨è¿”åˆ©(USDT)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">å›¢é˜Ÿè¿”åˆ©(CNY)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 120px;">å›¢é˜Ÿè¿”åˆ©(USDT)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 100px;">ç­¾åˆ°ç§¯åˆ†</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 80px;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${vipConfig.map((v, idx) => `
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e8e8e8; text-align: center;">${v.level}</td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="text" value="${v.name}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="name" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.min_investment_cny}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="min_investment_cny" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.min_investment_usdt}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="min_investment_usdt" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" step="0.0001" value="${v.interest_bonus_cny}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="interest_bonus_cny" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" step="0.0001" value="${v.interest_bonus_usdt}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="interest_bonus_usdt" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.direct_rebate_cny}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="direct_rebate_cny" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.direct_rebate_usdt}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="direct_rebate_usdt" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.team_rebate_cny}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="team_rebate_cny" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.team_rebate_usdt}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="team_rebate_usdt" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${v.sign_points}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="sign_points" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8; text-align: center;">
                                    <button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="editVipLevel(${idx})">ç¼–è¾‘</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('vipConfigTable').innerHTML = html;
        }

        // æ¸²æŸ“å›¢é˜Ÿå¥–åŠ±è¡¨æ ¼
        function renderTeamRewardTable(teamConfig) {
            const html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 100px;">ID</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">æœ€å°‘ä¸‹çº§æˆå‘˜æ•°</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">æœ€å°‘ç´¯è®¡æŠ•èµ„(CNY)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">æœ€å°‘ç´¯è®¡æŠ•èµ„(USDT)</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 150px;">å¥–åŠ±ç§¯åˆ†</th>
                            <th style="padding: 8px; border: 1px solid #e8e8e8; width: 80px;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${teamConfig.map((t, idx) => `
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e8e8e8; text-align: center;">${t.id}</td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${t.member_count}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="member_count" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${t.total_investment_cny}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="total_investment_cny" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${t.total_investment_usdt}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="total_investment_usdt" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8;"><input type="number" value="${t.reward_points}" style="width: 100%; padding: 4px; border: 1px solid #d9d9d9; background: white;" data-field="reward_points" data-idx="${idx}"></td>
                                <td style="padding: 8px; border: 1px solid #e8e8e8; text-align: center;">
                                    <button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="editTeamRewardLevel(${idx})">ç¼–è¾‘</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('teamRewardTable').innerHTML = html;
        }

        // ä¿å­˜æ‰€æœ‰è®¾ç½®
        async function saveAllSettings() {
            const config = {
                exchange_rate: {
                    usdt_to_cny: parseFloat(document.getElementById('exchangeRate').value)
                },
                vip_config: collectVipConfig(),
                team_reward_config: collectTeamConfig(),
                trial_money: {
                    amount_cny: parseFloat(document.getElementById('trialAmountCny').value),
                    amount_usdt: parseFloat(document.getElementById('trialAmountUsdt').value),
                    duration_days: parseInt(document.getElementById('trialDuration').value),
                    require_kyc: document.getElementById('trialRequireKyc').value == 1,
                    require_bind_payment: document.getElementById('trialRequirePayment').value == 1,
                    one_per_user: document.getElementById('trialOnePerUser').value == 1,
                    description: document.getElementById('trialDescription').value
                },
                investment: {
                    min_amount_cny: parseFloat(document.getElementById('investMinCny').value),
                    max_amount_cny: parseFloat(document.getElementById('investMaxCny').value),
                    min_amount_usdt: parseFloat(document.getElementById('investMinUsdt').value),
                    max_amount_usdt: parseFloat(document.getElementById('investMaxUsdt').value),
                    require_kyc: document.getElementById('investRequireKyc').value == 1,
                    require_bind_payment: document.getElementById('investRequirePayment').value == 1
                },
                recharge: {
                    cny: {
                        min_amount: parseFloat(document.getElementById('rechargeMinCny').value),
                        max_amount: parseFloat(document.getElementById('rechargeMaxCny').value),
                        fee_rate: parseFloat(document.getElementById('rechargeFeeRateCny').value) / 100
                    },
                    usdt: {
                        min_amount: parseFloat(document.getElementById('rechargeMinUsdt').value),
                        max_amount: parseFloat(document.getElementById('rechargeMaxUsdt').value),
                        fee_rate: parseFloat(document.getElementById('rechargeFeeRateUsdt').value) / 100
                    }
                },
                withdrawal: {
                    cny: {
                        min_amount: parseFloat(document.getElementById('withdrawMinCny').value),
                        max_amount: parseFloat(document.getElementById('withdrawMaxCny').value),
                        fee_rate: parseFloat(document.getElementById('withdrawFeeRateCny').value) / 100,
                        daily_limit: parseFloat(document.getElementById('withdrawDailyLimitCny').value)
                    },
                    usdt: {
                        min_amount: parseFloat(document.getElementById('withdrawMinUsdt').value),
                        max_amount: parseFloat(document.getElementById('withdrawMaxUsdt').value),
                        fee_rate: parseFloat(document.getElementById('withdrawFeeRateUsdt').value) / 100,
                        daily_limit: parseFloat(document.getElementById('withdrawDailyLimitUsdt').value)
                    }
                },
                ribao: {
                    daily_interest_rate_cny: parseFloat(document.getElementById('ribaoRateCny').value),
                    daily_interest_rate_usdt: parseFloat(document.getElementById('ribaoRateUsdt').value),
                    min_amount_cny: parseFloat(document.getElementById('ribaoMinCny').value),
                    min_amount_usdt: parseFloat(document.getElementById('ribaoMinUsdt').value),
                    settle_time: document.getElementById('ribaoSettleTime').value
                }
            };

            try {
                const res = await fetch(`${API_BASE}/system/update-config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                const data = await res.json();
                if (data.code === 1) {
                    alert('âœ“ æ‰€æœ‰ç³»ç»Ÿé…ç½®å·²ä¿å­˜æˆåŠŸ');
                    loadAllSettings(); // é‡æ–°åŠ è½½
                } else {
                    alert('ä¿å­˜å¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // æ”¶é›†VIPé…ç½®æ•°æ®
        function collectVipConfig() {
            const inputs = document.querySelectorAll('#vipConfigTable input');
            const vipConfig = [];
            let currentLevel = {};
            let lastIdx = -1;

            inputs.forEach(input => {
                const idx = parseInt(input.dataset.idx);
                const field = input.dataset.field;

                if (idx !== lastIdx) {
                    if (Object.keys(currentLevel).length > 0) {
                        vipConfig.push(currentLevel);
                    }
                    currentLevel = { level: idx };
                    lastIdx = idx;
                }

                if (field) {
                    if (['min_investment_cny', 'min_investment_usdt', 'max_amount_cny', 'max_amount_usdt'].includes(field)) {
                        currentLevel[field] = parseFloat(input.value);
                    } else if (['interest_bonus_cny', 'interest_bonus_usdt'].includes(field)) {
                        currentLevel[field] = parseFloat(input.value);
                    } else if (['direct_rebate_cny', 'direct_rebate_usdt', 'team_rebate_cny', 'team_rebate_usdt', 'sign_points'].includes(field)) {
                        currentLevel[field] = parseInt(input.value);
                    } else {
                        currentLevel[field] = input.value;
                    }
                }
            });

            if (Object.keys(currentLevel).length > 0) {
                vipConfig.push(currentLevel);
            }

            return vipConfig;
        }

        // æ”¶é›†å›¢é˜Ÿå¥–åŠ±é…ç½®æ•°æ®
        function collectTeamConfig() {
            const inputs = document.querySelectorAll('#teamRewardTable input');
            const teamConfig = [];
            let currentTeam = {};
            let lastIdx = -1;

            inputs.forEach(input => {
                const idx = parseInt(input.dataset.idx);
                const field = input.dataset.field;

                if (idx !== lastIdx) {
                    if (Object.keys(currentTeam).length > 0) {
                        currentTeam.id = teamConfig.length + 1;
                        teamConfig.push(currentTeam);
                    }
                    currentTeam = {};
                    lastIdx = idx;
                }

                if (field) {
                    if (['member_count', 'total_investment_cny', 'total_investment_usdt', 'reward_points'].includes(field)) {
                        currentTeam[field] = parseFloat(input.value);
                    } else {
                        currentTeam[field] = input.value;
                    }
                }
            });

            if (Object.keys(currentTeam).length > 0) {
                currentTeam.id = teamConfig.length + 1;
                teamConfig.push(currentTeam);
            }

            return teamConfig;
        }

        function addVipLevel() {
            alert('è¯¥åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒæ–°å¢VIPç­‰çº§');
        }

        function editVipLevel(idx) {
            alert('ç¼–è¾‘VIPç­‰çº§ ' + idx);
        }

        function addTeamRewardLevel() {
            alert('è¯¥åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒæ–°å¢å¥–åŠ±ç­‰çº§');
        }

        function editTeamRewardLevel(idx) {
            alert('ç¼–è¾‘å›¢é˜Ÿå¥–åŠ±ç­‰çº§ ' + idx);
        }

        // åŠ è½½ç³»ç»Ÿè®¾ç½®
        async function loadSystemSettings() {
            loadAllSettings();
        }

        // ä¿å­˜ç³»ç»Ÿè®¾ç½®ï¼ˆä¿ç•™æ—§çš„åç§°ä»¥ä¿æŒå…¼å®¹æ€§ï¼‰
        async function saveSystemSettings() {
            saveAllSettings();
        }

        // åŠ è½½æ“ä½œæ—¥å¿—
        async function loadLogs() {
            try {
                const res = await fetch(`${API_BASE}/logs/list`);
                const data = await res.json();
                if (data.code === 1) {
                    const tbody = document.getElementById('logTableBody');
                    if (data.data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">æš‚æ— æ—¥å¿—</td></tr>';
                    } else {
                        tbody.innerHTML = data.data.map(log => `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.type}</td>
                                <td>${log.operator}</td>
                                <td>${log.content}</td>
                                <td>${log.create_time}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', error);
                // æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®
                const tbody = document.getElementById('logTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td>1</td>
                        <td>ç”¨æˆ·ç®¡ç†</td>
                        <td>ç®¡ç†å‘˜</td>
                        <td>å†»ç»“ç”¨æˆ· ID: 3</td>
                        <td>2024-01-15 10:30:00</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>é¡¹ç›®ç®¡ç†</td>
                        <td>ç®¡ç†å‘˜</td>
                        <td>åˆ›å»ºé¡¹ç›®: ç¨³å¥ç†è´¢30å¤©</td>
                        <td>2024-01-15 09:15:00</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>è´¢åŠ¡ç®¡ç†</td>
                        <td>ç®¡ç†å‘˜</td>
                        <td>å®¡æ ¸é€šè¿‡å……å€¼ ID: 1001</td>
                        <td>2024-01-15 08:45:00</td>
                    </tr>
                `;
            }
        }

        // æœç´¢æ—¥å¿—
        async function searchLogs() {
            const keyword = document.getElementById('logSearch').value;
            try {
                const res = await fetch(`${API_BASE}/logs/list`);
                const data = await res.json();
                if (data.code === 1) {
                    let logs = data.data;
                    if (keyword) {
                        logs = logs.filter(log =>
                            log.type.includes(keyword) ||
                            log.operator.includes(keyword) ||
                            log.content.includes(keyword)
                        );
                    }
                    const tbody = document.getElementById('logTableBody');
                    if (logs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">æš‚æ— æ—¥å¿—</td></tr>';
                    } else {
                        tbody.innerHTML = logs.map(log => `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.type}</td>
                                <td>${log.operator}</td>
                                <td>${log.content}</td>
                                <td>${log.create_time}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('æœç´¢æ—¥å¿—å¤±è´¥:', error);
            }
        }

        // æœç´¢ç”¨æˆ·
        function searchUsers() {
            loadUsers();
        }

        // é‡ç½®ç”¨æˆ·æœç´¢
        function resetUserSearch() {
            document.getElementById('userSearch').value = '';
            document.getElementById('userStatusFilter').value = '';
            document.getElementById('userVipFilter').value = '';
            loadUsers();
        }

        // æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
        async function viewUserDetail(userId) {
            try {
                const res = await fetch(`${API_BASE}/admin/user-detail?id=${userId}`);
                const data = await res.json();
                if (data.code === 1) {
                    const user = data.data;
                    const detailHtml = `
                        <div style="padding: 20px;">
                            <h3 style="margin-bottom: 16px;">ç”¨æˆ·è¯¦æƒ…</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div><strong>ç”¨æˆ·ID:</strong> ${user.id}</div>
                                <div><strong>ç”¨æˆ·å:</strong> ${user.username}</div>
                                <div><strong>æ‰‹æœºå·:</strong> ${user.phone || 'æœªç»‘å®š'}</div>
                                <div><strong>é‚®ç®±:</strong> ${user.email || 'æœªç»‘å®š'}</div>
                                <div><strong>VIPç­‰çº§:</strong> VIP${user.vip_level || 0}</div>
                                <div><strong>å®åè®¤è¯:</strong> ${user.kyc_status === 2 ? 'å·²è®¤è¯' : user.kyc_status === 1 ? 'å¾…å®¡æ ¸' : 'æœªè®¤è¯'}</div>
                                <div><strong>CNYä½™é¢:</strong> Â¥${(user.balance_cny || 0).toLocaleString()}</div>
                                <div><strong>USDTä½™é¢:</strong> $${(user.balance_usdt || 0).toLocaleString()}</div>
                                <div><strong>ç´¯è®¡æŠ•èµ„:</strong> Â¥${(user.total_investment || 0).toLocaleString()}</div>
                                <div><strong>ç´¯è®¡è¿”åˆ©:</strong> Â¥${(user.total_rebate || 0).toLocaleString()}</div>
                                <div><strong>çŠ¶æ€:</strong> ${user.status === 1 ? 'æ­£å¸¸' : 'å†»ç»“'}</div>
                                <div><strong>æ³¨å†Œæ—¶é—´:</strong> ${user.create_time || 'æœªçŸ¥'}</div>
                            </div>
                            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e8e8e8; display: flex; justify-content: flex-end; gap: 12px;">
                                <button class="btn" onclick="closeUserDetailModal()">å…³é—­</button>
                                <button class="btn btn-primary" onclick="editUser(${user.id})">ç¼–è¾‘</button>
                            </div>
                        </div>
                    `;
                    showModal('ç”¨æˆ·è¯¦æƒ…', detailHtml);
                } else {
                    alert('åŠ è½½ç”¨æˆ·è¯¦æƒ…å¤±è´¥ï¼š' + data.msg);
                }
            } catch (error) {
                alert('åŠ è½½ç”¨æˆ·è¯¦æƒ…å¤±è´¥ï¼š' + error.message);
            }
        }

        // ç¼–è¾‘ç”¨æˆ·
        function editUser(userId) {
            alert('ç¼–è¾‘ç”¨æˆ·åŠŸèƒ½å¾…å®ç°ï¼Œç”¨æˆ·ID: ' + userId);
        }

        // æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼ˆé€šç”¨ï¼‰
        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <h2>${title}</h2>
                    ${content}
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        // å…³é—­ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
        function closeUserDetailModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(m => {
                if (m.style.display === 'block') {
                    document.body.removeChild(m);
                }
            });
        }

        // åˆå§‹åŒ–åŠ è½½
        loadDashboard();
    </script>
</body>
</html>
